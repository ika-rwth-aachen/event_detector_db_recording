<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>event_detector_db_recording_plugin: Event Detector Action Plugin | &lt;em&gt;Database Recording&lt;/em&gt;</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">event_detector_db_recording_plugin<span id="projectnumber">&#160;1.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Event Detector Action Plugin | <em>Database Recording</em> </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p align="center"><a class="anchor" id="md_README"></a> </p>
<p align="center"></p>
<p><img src="https://img.shields.io/github/license/ika-rwth-aachen/event_detector_db_recording" alt="" class="inline"/></p>
<p><a href="https://ika-rwth-aachen.github.io/event_detector_db_recording/"><img src="https://github.com/ika-rwth-aachen/event_detector_db_recording/actions/workflows/doc.yml/badge.svg" alt="" style="pointer-events: none;" class="inline"/></a> <img src="https://img.shields.io/badge/ROS 2-jazzy-293754" alt="" class="inline"/> </p>
<p align="center"></p>
<p>⸻ <b><em><a href="#quick-start">Quick Start</a></em></b> | <b><em><a href="#analysis-rules">Analysis Rules</a></em></b> | <b><em><a href="#installation">Installation</a></em></b> | <b><em><a href="#documentation">Documentation</a></em></b> | <b><em><a href="#research-article">Research Article</a></em></b> | <b><em><a href="#acknowledgements">Acknowledgements</a></em></b> ⸻ </p>
<p><code>event_detector_db_recording</code> is an action plugin for the ROS 2 <a href="https://github.com/ika-rwth-aachen/event_detector">event detector framework</a> that allows to write data from buffer to a database. With this action plugin, you can automatically ...</p><ul>
<li><em><b>buffer</b></em> ROS messages of arbitrary message type;</li>
<li><em><b>detect</b></em> events by analyzing the buffer contents with existing or custom analysis rules;</li>
<li><em><b>trigger</b></em> the storage of buffer contents to a MongoDB database instance.</li>
</ul>
<p>In order to give an example, with this action plugin you can automatically ...</p><ul>
<li>buffer robot sensor data;</li>
<li>detect malfunction identified by some quantity exceeding a certain threshold;</li>
<li>trigger the storage of all buffered data leading up to the incident.</li>
</ul>
<p>The example illustrates that the event detector framework is highly modular and customizable.</p><ul>
<li>You can process data of arbitrary ROS message type, including custom type definitions.</li>
<li>You can use any of the existing <em>analysis rules</em> to detect an event (e.g., <em>value exceeding threshold</em>) or define your own logic to detect events by implementing a single C++ function in a custom <em>analysis rule</em>.</li>
</ul>
<blockquote class="doxtable">
<p>&zwj;[!IMPORTANT] <br  />
 This repository is open-sourced and maintained by the <a href="https://www.ika.rwth-aachen.de/"><b>Institute for Automotive Engineering (ika) at RWTH Aachen University</b></a>. <br  />
 <b>Advanced C-ITS Use Cases</b> are one of many research topics within our <a href="https://www.ika.rwth-aachen.de/en/competences/fields-of-research/vehicle-intelligence-automated-driving.html"><em>Vehicle Intelligence &amp; Automated Driving</em></a> domain. <br  />
 If you would like to learn more about how we can support your advanced driver assistance and automated driving efforts, feel free to reach out to us! <br  />
 :email: ***opensource@ika.rwth-aachen.de*** </p>
</blockquote>
<h1><a class="anchor" id="autotoc_md1"></a>
Quick Start</h1>
<blockquote class="doxtable">
<p>&zwj;[!TIP] Check out the <a href="https://github.com/ika-rwth-aachen/event_detector_examples">examples repository</a> to see the event detector and all of its action plugins in action! <br  />
 The examples also give a good idea of potential use cases for the event detector. </p>
</blockquote>
<h1><a class="anchor" id="autotoc_md2"></a>
Analysis Rules</h1>
<p>The concrete detection of any specific event and the concrete action that should be triggered are implemented in analysis rules of event detector action plugins. Existing analysis rules of the database recording plugin are listed here. We highlight that the action plugin is easily extensible with new developer-defined analysis rules, see *How to implement a custom analysis rule*.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Analysis Rule   </th><th class="markdownTableHeadNone">Purpose    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="md_event__detector__db__recording__plugin_2include_2event__detector__db__recording__plugin_2rules_2record__all_2README.html">`RecordAllRule`</a>   </td><td class="markdownTableBodyNone">record all buffered data to database   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md3"></a>
Installation</h1>
<p>You can integrate the event detector with database recording plugin into your existing ROS 2 workspace by cloning the repository, installing all dependencies using <a href="http://wiki.ros.org/rosdep"><em>rosdep</em></a>, <a href="https://github.com/dirk-thomas/vcstool"><em>vcstool</em></a>, and a custom script for external dependencies, and then building from source.</p>
<div class="fragment"><div class="line"># ROS workspace$</div>
<div class="line">git clone https://github.com/ika-rwth-aachen/event_detector_db_recording.git src/event_detector_db_recording</div>
<div class="line">rosdep install -r --ignore-src --from-paths src/event_detector_db_recording</div>
<div class="line">vcs import src &lt; src/event_detector_db_recording/.repos</div>
<div class="line">./src/event_detector_db_recording/docker/custom.sh</div>
<div class="line">colcon build --packages-up-to event_detector_db_recording --cmake-args -DCMAKE_BUILD_TYPE=Release</div>
</div><!-- fragment --><p>The event detector with database recording plugin can then be launched. </p><div class="fragment"><div class="line"># ROS workspace$</div>
<div class="line">source install/setup.bash</div>
<div class="line">ros2 launch event_detector_db_recording_plugin event_detector_db_recording_plugin.launch.py startup_state:=3</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md5"></a>
Documentation</h1>
<h2><a class="anchor" id="autotoc_md6"></a>
Code Documentation</h2>
<p>Browsable Doxygen code documentation is available <a href="https://ika-rwth-aachen.github.io/event_detector_db_recording">here</a>.</p>
<h2><a class="anchor" id="autotoc_md7"></a>
Topics, Services, Parameters</h2>
<p>Analysis rules are separately documented, see *Analysis Rules*.</p>
<details >
<summary >
<em>Click to show</em></summary>
<p></p>
<p></p>
</details>
<h3><a class="anchor" id="autotoc_md8"></a>
Subscribed Topics</h3>
<p>Subscriptions for buffering data are specified via the core parameter <a href="https://github.com/ika-rwth-aachen/event_detector?tab=readme-ov-file#parameters"><code>client_params.&lt;CLIENT_NAME&gt;.data_type_params.&lt;DATA_TYPE&gt;.topics</code></a>. Analysis rules may define additional subscribers.</p>
<h3><a class="anchor" id="autotoc_md9"></a>
Published Topics</h3>
<p>None by default. Analysis rules may define additional publishers.</p>
<h3><a class="anchor" id="autotoc_md10"></a>
Parameters</h3>
<p>Parameters of the core event detector are <a href="https://github.com/ika-rwth-aachen/event_detector?tab=readme-ov-file#parameters">documented here</a>. All database recording plugin rules additionally define the following parameters under <code>rule_params.&lt;RULE_NAME&gt;.parameters</code>. Analysis rules may define more parameters.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter   </th><th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Default   </th><th class="markdownTableHeadNone">Description   </th><th class="markdownTableHeadNone">Options    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>database.name</code>   </td><td class="markdownTableBodyNone"><code>string</code>   </td><td class="markdownTableBodyNone"><code>db</code>   </td><td class="markdownTableBodyNone">database name   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>database.host</code>   </td><td class="markdownTableBodyNone"><code>string</code>   </td><td class="markdownTableBodyNone"><code>localhost</code>   </td><td class="markdownTableBodyNone">database host   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>database.port</code>   </td><td class="markdownTableBodyNone"><code>int</code>   </td><td class="markdownTableBodyNone"><code>27017</code>   </td><td class="markdownTableBodyNone">database port   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>database.user</code>   </td><td class="markdownTableBodyNone"><code>string</code>   </td><td class="markdownTableBodyNone"><code>\ilinebr &lt;/td&gt; &lt;td class="markdownTableBodyNone"&gt; database user \ilinebr &lt;/td&gt; &lt;td class="markdownTableBodyNone"&gt; \ilinebr &lt;/td&gt; &lt;/tr&gt; &lt;tr class="markdownTableRowOdd"&gt; &lt;td class="markdownTableBodyNone"&gt; `database.pass` \ilinebr &lt;/td&gt; &lt;td class="markdownTableBodyNone"&gt; `string` \ilinebr &lt;/td&gt; &lt;td class="markdownTableBodyNone"&gt;</code>   </td><td class="markdownTableBodyNone">database user password   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>database.large_data_root</code>   </td><td class="markdownTableBodyNone"><code>string</code>   </td><td class="markdownTableBodyNone">`<code>\ilinebr &lt;/td&gt; &lt;td class="markdownTableBodyNone"&gt; directory for large data storage (see [*Supported data types*](#supported-data-types)) \ilinebr &lt;/td&gt; &lt;td class="markdownTableBodyNone"&gt; \ilinebr &lt;/td&gt; &lt;/tr&gt; &lt;tr class="markdownTableRowOdd"&gt; &lt;td class="markdownTableBodyNone"&gt;</code>database.dry_run<code>\ilinebr &lt;/td&gt; &lt;td class="markdownTableBodyNone"&gt;</code>bool<code>\ilinebr &lt;/td&gt; &lt;td class="markdownTableBodyNone"&gt;</code>false`   </td><td class="markdownTableBodyNone">whether to perform a dry run (no data will be stored)   </td><td class="markdownTableBodyNone"></td></tr>
</table>
<h2><a class="anchor" id="autotoc_md11"></a>
Supported data types</h2>
<details >
<summary >
<em>Click to show</em></summary>
<p></p>
<p>The database recording plugin natively supports all ROS message types supported by the core event detector, see <a href="https://github.com/ika-rwth-aachen/event_detector?tab=readme-ov-file#supported-data-types"><em>Supported data types</em></a>.</p>
<p>The database recording plugin has the notion of <em>large data types</em>. Data of large data types is not directly stored in the database, but is written to disk instead. To give an example, <code>sensor_msgs/msg/Image</code> messages are not directly stored in the database, but images are written to PNG files on disk instead. What is written to the database, are corresponding messages of type <a href="https://github.com/ika-rwth-aachen/event_detector_db_recording_msgs/blob/main/event_detector_db_recording_msgs/msg/ImageFile.msg"><code>event_detector_db_recording_msgs/msg/ImageFile</code></a>, which store the file location on disk in the database. All large data types define a corresponding replacement data type in <a href="./event_detector_db_recording_plugin/include/event_detector_db_recording_plugin/datatypes.macro"><code>datatypes.macro</code></a> and implement the writing to disk behavior in the <a href="./event_detector_db_recording_plugin/include/event_detector_db_recording_plugin/DatabaseInterface.hpp"><code>DatabaseInterface</code></a>.</p>
<p></p>
</details>
<h2><a class="anchor" id="autotoc_md12"></a>
How to implement a custom analysis rule</h2>
<details >
<summary >
<em>Click to show</em></summary>
<p></p>
<p>In general, follow the <a href="https://github.com/ika-rwth-aachen/event_detector?tab=readme-ov-file#how-to-implement-a-custom-analysis-rule">generic instructions</a> for implementing a custom analysis rule in the event detector framework. The <a href="./event_detector_db_recording_plugin/include/event_detector_db_recording_plugin/rules/template/"><code>event_detector_db_recording_plugin::TemplateRule</code></a> is a good point to get started with an analysis rule for the database recording plugin.</p>
<p>Note that the <code>TemplateRule</code> inherits <a href="./event_detector_db_recording_plugin/include/event_detector_db_recording_plugin/RecordingRule.hpp"><code>event_detector_db_recording_plugin::RecordingRule</code></a> instead of directly inheriting <a href="https://github.com/ika-rwth-aachen/event_detector/blob/main/event_detector/include/event_detector/AnalysisRule.hpp"><code>event_detector::AnalysisRule</code></a>. The abstract <code>RecordingRule</code> implements the entire functionality for interfacing with a MongoDB database. This way, concrete analysis rules in the database recording plugin only need to implement the event detection by overriding <code>event_detector::AnalysisRule::evaluate()</code> (e.g., <code>event_detector_db_recording_plugin::TemplateRule::evaluate()</code>) and have it call <code><a class="el" href="classevent__detector__db__recording__plugin_1_1RecordingRule.html#a3f88b422d8ba9f0a1b9d0a710df29668" title="Triggers storage of data in database.">event_detector_db_recording_plugin::RecordingRule::trigger</a>(const EvaluationResult&amp;)</code> at the end to trigger storage.</p>
<p></p>
</details>
<h1><a class="anchor" id="autotoc_md13"></a>
Research Article</h1>
<p>If you are interested in the role of event detection in modern automated driving systems and Cooperative Intelligent Transport Systems (C-ITS), please check out our associated research article on the topic and consider citing it if you are using the event detector for your own research.</p>
<blockquote class="doxtable">
<p>&zwj;<b>Event Detection in C-ITS: Classification, Use Cases, and Reference Implementation</b> <br  />
 *(<a href="https://www.researchgate.net/publication/388993060_Event_Detection_in_C-ITS_Classification_Use_Cases_and_Reference_Implementation">ResearchGate</a>)* <br  />
</p>
<p><a href="https://github.com/lreiher">Lennart Reiher</a>, <a href="https://github.com/bastilam">Bastian Lampe</a>, <a href="https://github.com/lukaszanger">Lukas Zanger</a>, <a href="https://www.ika.rwth-aachen.de/de/institut/team/fahrzeugintelligenz-automatisiertes-fahren/woopen.html">Timo Woopen</a>, <a href="https://www.ika.rwth-aachen.de/en/institute/team/univ-prof-dr-ing-lutz-eckstein.html">Lutz Eckstein</a> <br  />
 <a href="https://www.ika.rwth-aachen.de/en/">Institute for Automotive Engineering (ika), RWTH Aachen University</a></p>
<p><sup><em>Abstract</em> – The transition from traditional hardware-centric vehicles to software-defined vehicles is largely driven by a switch to modern architectural patterns of software, including service orientation and microservices. Automated driving systems (ADS), and even more so, Cooperative Intelligent Transport Systems (C-ITS), come with requirements for scalability, modularity, and adaptability that cannot be met with conventional software architectures. The complexity and dynamics of future mobility systems also suggest to employ ideas of the event-driven architecture paradigm: distributed systems need to be able to detect and respond to events in real-time and in an asynchronous manner. In this paper, we therefore stress the importance of data-driven event detection in the context of ADS and C-ITS. First, we propose a classification scheme for event-detection use cases. We then describe a diverse set of possible use cases and apply the classification scheme to a selection of concrete, innovative examples. Last, we present a modular event detection software framework that we publish as open-source software to foster further research and development of complex C-ITS use cases, but also for robotics in general.</sup> </p>
</blockquote>
<h1><a class="anchor" id="autotoc_md14"></a>
Acknowledgements</h1>
<p>This work is accomplished within the projects <em>6GEM</em> (FKZ 16KISK036K), <em>autotech.agil</em> (FKZ 01IS22088A), and <em>UNICAR.agil</em> (FKZ 16EMO0284K). We acknowledge the financial support for the projects by the <em>Federal Ministry of Education and Research of Germany (BMBF)</em>. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
